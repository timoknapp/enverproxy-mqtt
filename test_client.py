#!/usr/bin/python3           # This is client.py file

import socket
import select
import io
import time

# create a socket object
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# get local machine name
host = socket.gethostname()
host = 'localhost'
port = 10013
buffer_size = 4096

# connection to hostname on the port.
s.connect((host, port))

# Receive no more than 1024 bytes
msg1 = bytearray.fromhex('680030681006900105970000000002000010022300027983220242581d29009d055e25403ab332090000000000005e16')
msg2 = bytearray.fromhex('6803d668100490010597000000000000000000001112798322023e300ec1009d055e25193a51320500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf16')

#msg = msg[0:662]
#msg = msg.encode()

print('Sending message 1')
s.send(msg1)
print('Receiving 1st reply')
ss = select.select
ilist = []
ilist.append(s)
time.sleep(1)
inputready, outputready, exceptready = ss(ilist, [], [])
for sock in inputready:
    try:
        data = sock.recv(buffer_size)
        print(str(len(data)) + ' bytes received from ' + str(sock.getpeername()))
        print('As hex: ' + str(data.hex()))
    except OSError as e:
        print('Socket error: ' + str(e))
        time.sleep(1) 
        #self.on_close()
    else:
        continue
if len(data) > 0:    
    print('sending message 2')
    s.send(msg2)
print('Receiving 2nd reply')
ss = select.select
ilist = []
ilist.append(s)
time.sleep(1)
inputready, outputready, exceptready = ss(ilist, [], [])
for sock in inputready:
    try:
        data = sock.recv(buffer_size)
        print(str(len(data)) + ' bytes received from ' + str(sock.getpeername()))
        print('As hex: ' + str(data.hex()))
    except OSError as e:
        print('Socket error: ' + str(e))
        time.sleep(1) 
        #self.on_close()
    else:
        continue
print('Closing')
s.close()
